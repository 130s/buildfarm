<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description>Generate the rosdistro cache for hydro and make it available.&#xd;
&#xd;
Generated from buildfarm/resources/static_jobs. Do not edit on Jenkins but in the repository.</description>
  <logRotator>
    <daysToKeep>180</daysToKeep>
    <numToKeep>100</numToKeep>
    <artifactDaysToKeep>-1</artifactDaysToKeep>
    <artifactNumToKeep>-1</artifactNumToKeep>
  </logRotator>
  <keepDependencies>false</keepDependencies>
  <properties>
    <hudson.queueSorter.PrioritySorterJobProperty plugin="PrioritySorter@1.3">
      <priority>220</priority>
    </hudson.queueSorter.PrioritySorterJobProperty>
  </properties>
  <scm class="hudson.scm.NullSCM"/>
  <assignedNode>release</assignedNode>
  <canRoam>false</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers class="vector">
    <hudson.triggers.TimerTrigger>
      <spec>*/5 * * * *</spec>
    </hudson.triggers.TimerTrigger>
  </triggers>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.tasks.Shell>
      <command>sudo apt-get update
sudo apt-get install -y python-rosdistro
rosdistro_generate_cache hydro --cache `pwd`

# upload plain cache
scp -o StrictHostKeyChecking=no -qr `pwd`/hydro-dependencies.yaml rosbuild@wgs32:/var/www/www.ros.org/html/rosdistro/

# upload tar of cache
tar cvjf hydro-dependencies.tar.gz hydro-dependencies.yaml
scp -o StrictHostKeyChecking=no -qr hydro-dependencies.tar.gz rosbuild@wgs32:/var/www/www.ros.org/html/rosdistro/

### generate the outdated version of the new rosdistro format

if [ -e $WORKSPACE/rosdistro-rep137 ]
then
  rm -rf $WORKSPACE/rosdistro-rep137
fi
git clone git@github.com:ros/rosdistro.git $WORKSPACE/rosdistro-rep137 -b rep137
cd $WORKSPACE/rosdistro-rep137/releases

rosdistro_convert
rosdistro_build_cache file://`pwd`/index.yaml

scp -o StrictHostKeyChecking=no -qr `pwd`/groovy-cache.yaml rosbuild@wgs32:/var/www/www.ros.org/html/rosdistro/groovy-cache-old.yaml
scp -o StrictHostKeyChecking=no -qr `pwd`/hydro-cache.yaml rosbuild@wgs32:/var/www/www.ros.org/html/rosdistro/hydro-cache-old.yaml

GIT_DIFF=`git diff`
if [ "$GIT_DIFF" != "" ]; then
  git commit -m "update generated rep137 rosdistro files (under release)" -a
  git push
fi

### generate the latest version of the new rosdistro format

if [ -e $WORKSPACE/rosdistro ]
then
  rm -rf $WORKSPACE/rosdistro
fi
git clone git@github.com:ros-infrastructure/rosdistro.git $WORKSPACE/rosdistro
cd $WORKSPACE/rosdistro-rep137

PATH=$WORKSPACE/rosdistro/scripts:$PATH
export PYTHONPATH=$WORKSPACE/rosdistro/src:$PYTHONPATH

rosdistro_convert
rosdistro_build_cache file://`pwd`/index.yaml

scp -o StrictHostKeyChecking=no -qr `pwd`/groovy/release-cache.yaml rosbuild@wgs32:/var/www/www.ros.org/html/rosdistro/groovy-cache.yaml
scp -o StrictHostKeyChecking=no -qr `pwd`/hydro/release-cache.yaml rosbuild@wgs32:/var/www/www.ros.org/html/rosdistro/hydro-cache.yaml

GIT_DIFF=`git diff`
if [ "$GIT_DIFF" != "" ]; then
  git commit -m "update generated rep137 rosdistro files (under root)" -a
  git push
fi</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers>
    <hudson.tasks.Mailer>
      <recipients>ros-buildfarm-status@googlegroups.com</recipients>
      <dontNotifyEveryUnstableBuild>true</dontNotifyEveryUnstableBuild>
      <sendToIndividuals>false</sendToIndividuals>
    </hudson.tasks.Mailer>
  </publishers>
  <buildWrappers/>
</project>